<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'base_head.htm' -%}
    {% block head -%}
    {% endblock head -%}
    <style>
      /*style stuff */
    </style>
  </head>
  <body>
    {% set active_page = "search" %}
    {% include 'header.htm' -%}

    <div class="container">
      <div row>

      </div>
      <div class="row">
        <div class="col-8 border-right">
          <h3> {{ title }} </h3>
          <form action="/search"/ method="GET">
            <div class="form-group">
              <label for="largesearchbar">Putting the Q in QUOREM.</label>
              <input class="form-control form-control-lg" type="text" placeholder="16S rRNA" name="q2" id="largesearchbar">
            </div>
            <button type="submit" class="btn btn-success">Search</button>
          </form>
          {% if selected %}
          <p>Filters:</p>
            {% if selected.type %}
              {% if q %}
              <a href="?q={{ q }}" class="btn btn-outline-primary">
              {% else %}
              <a href="/search/" class="btn btn-outline-primary">
              {% endif %}
                {{ selected.type }}  <span>&times;</span></a><br>
                {% if meta %}
                  {% if q %}
                  <a href="?q={{ q }}&type={{ type }}" class="btn btn-outline-success">
                  {% else %}
                  <a href="?type={{ type }}" class="btn btn-outline-success">
                  {% endif %}
                    {{ meta }} <span>&times;</span></a><br>
                {% endif %}
            {% endif %}
          {% endif %}


            {% if page_total %}
              {% if q %}
                {% if page_total %}
                  <strong>{{ page_total }} result{{ page_total|pluralize }}</strong><br><br>
                {% endif %}
                {% include "_pagination.htm" %}
                {% include "mixed_object_list.htm" %}
                {% include "_pagination.htm" %}
              {% endif %}
            {% else %}
              <h3> No results found. </h3>
            {% endif %}
      </div>
      <div class="col-4">
        <div class="card">
          <div class="card-header bg-primary">
          </div>
          <div class="card-body">
            <h5>Search Filters</h5>
              <ul class="list-group list-group-flush">
              {% if type_counts %}
                {% for t in type_counts %}
                  <li class='list-group-item'>
                    {% if q %}
                      <a href="?q={{ q }}&type={{ t.name }}">
                    {% else %}
                      <a href="?type={{ t.name }}">
                    {% endif %}
                      {{ t.type }}  <span class="badge badge-pill badge-secondary">{{ t.n }}</span></a></li>
                {% endfor %}
              {% endif %}
              </ul>
          </div>
          {% if metadata %}
          <!-- Display additional facets if a metadata category is selected -->
            <div class="card-header bg-success">
            </div>
            <div class="card-body">
              <h5>Additional Filters</h5>
                <ul class="list-group list-group-flush">
                  <!-- IF a search facet is selected, display it and
                       render a removable tag. -->
                  {% if meta %}
                  <li class="list-group-item">
                    {% if q %}
                      <a href="?q={{ q }}&type={{ type }}&meta={{ meta }}">
                    {% else %}
                      <a href="?type={{ type }}&meta={{ meta}}">
                    {% endif %}
                    {{ meta }}
                  </li>
                  <!-- check for value range and render it. -->
                </ul>

                {% if value_range %}
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">
                    Min: {{ value_range.min['value__min'] }} <br>
                    Max: {{ value_range. max['value__max'] }}
                  </li>
                </ul>
                {% endif %}
                  {% else %}
                  <!-- If a facet is not selected, render options. -->
                  {% for k in metadata %}
                  <li class="list-group-item">
                    {% if q %}
                      <a href="?q={{ q }}&type={{ type }}&meta={{ k.key }}">
                    {% else %}
                      <a href="?type={{ type }}&meta={{ k.key }}">
                    {% endif %}
                    {{ k.key }}
                  </li>

                  {% endfor %}
                  </ul>
                  {% endif %}

            </div>
          {% endif %}
        </div>
     </div>
    </div>
  </div> <!--container -->
    {% include 'base_bottom_scripts.htm' -%}
    {% block bottom_scripts -%}
    {% endblock bottom_scripts -%}
  </body>
</html>
